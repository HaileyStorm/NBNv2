<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:Nbn.Tools.Workbench.ViewModels"
             x:Class="Nbn.Tools.Workbench.Views.Panels.VizPanel"
             x:DataType="vm:VizPanelViewModel">
  <ScrollViewer HorizontalScrollBarVisibility="Disabled">
    <StackPanel Spacing="16">
      <Border Classes="card">
        <StackPanel Spacing="10">
          <TextBlock Text="Visualizer" Classes="card-title" />
          <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="6">
            <TextBlock Text="Known brains" Classes="muted" />
            <ComboBox Grid.Column="1" ItemsSource="{Binding KnownBrains}" SelectedItem="{Binding SelectedBrain}" Width="320">
              <ComboBox.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding Display}" />
                </DataTemplate>
              </ComboBox.ItemTemplate>
            </ComboBox>
            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="6">
              <TextBox Width="200" Text="{Binding BrainEntryText}" Watermark="Paste BrainId" />
              <Button Content="Add" Command="{Binding AddBrainCommand}" />
            </StackPanel>

            <TextBlock Grid.Row="1" Text="Region focus" Classes="muted" />
            <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Spacing="8">
              <TextBox Width="80" Text="{Binding RegionFocusText}" />
              <Button Content="Zoom" Command="{Binding ZoomCommand}" />
            </StackPanel>
            <TextBlock Grid.Row="1" Grid.Column="2" Text="{Binding Status}" Classes="muted" VerticalAlignment="Center" />
          </Grid>
        </StackPanel>
      </Border>

      <Grid ColumnDefinitions="1.05*,1.35*" ColumnSpacing="16">
        <StackPanel Spacing="16" Grid.Column="0">
          <Border Classes="card">
            <StackPanel Spacing="8">
              <TextBlock Text="Brain Control" Classes="card-title" />
              <TextBlock Text="Brain ID" Classes="muted" />
              <TextBox Text="{Binding Brain.BrainIdText}" Watermark="Guid" IsReadOnly="True" />
              <StackPanel Orientation="Horizontal" Spacing="8">
                <Button Content="Refresh Info" Command="{Binding Brain.RequestInfoCommand}" />
              </StackPanel>
              <TextBlock Text="{Binding Brain.BrainInfoSummary}" Classes="muted" />
            </StackPanel>
          </Border>

          <Border Classes="card">
            <StackPanel Spacing="8">
              <TextBlock Text="Inputs" Classes="card-title" />
              <Grid ColumnDefinitions="Auto,Auto,Auto,Auto" ColumnSpacing="8" RowDefinitions="Auto,Auto">
                <TextBlock Text="Index" Classes="muted" />
                <TextBox Grid.Column="1" Text="{Binding Brain.InputIndexText}" Width="80" HorizontalAlignment="Left" />
                <TextBlock Grid.Column="2" Text="Value" Classes="muted" />
                <TextBox Grid.Column="3" Text="{Binding Brain.InputValueText}" Width="100" HorizontalAlignment="Left" />
                <TextBlock Grid.Row="1" Text="Vector" Classes="muted" />
                <TextBox Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="3" Text="{Binding Brain.InputVectorText}" Watermark="0.1, 0.2, -0.3" />
              </Grid>
              <StackPanel Orientation="Horizontal" Spacing="8">
                <Button Content="Send Input" Command="{Binding Brain.SendInputCommand}" />
                <Button Content="Send Vector" Command="{Binding Brain.SendVectorCommand}" />
              </StackPanel>
            </StackPanel>
          </Border>

          <Border Classes="card">
            <StackPanel Spacing="8">
              <TextBlock Text="Energy + Cost (Selected Brain)" Classes="card-title" />
              <TextBlock Text="Applies only to the selected brain above." Classes="muted" />
              <Grid ColumnDefinitions="Auto,Auto,Auto" RowDefinitions="Auto,Auto" ColumnSpacing="8" RowSpacing="6">
                <TextBlock Text="Credit" Classes="muted" />
                <TextBox Grid.Column="1" Text="{Binding Brain.EnergyCreditText}" Width="100" />
                <Button Grid.Column="2" Content="Apply" Command="{Binding ApplyEnergyCreditCommand}" />
                <TextBlock Grid.Row="1" Text="Rate" Classes="muted" />
                <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding Brain.EnergyRateText}" Width="100" />
                <Button Grid.Row="1" Grid.Column="2" Content="Apply" Command="{Binding ApplyEnergyRateCommand}" />
              </Grid>
              <StackPanel Orientation="Horizontal" Spacing="12">
                <CheckBox Content="Cost + Energy Enabled" IsChecked="{Binding Brain.CostEnergyEnabled}" />
                <Button Content="Update Flags" Command="{Binding ApplyCostEnergyCommand}" />
              </StackPanel>
            </StackPanel>
          </Border>
        </StackPanel>

        <StackPanel Grid.Column="1" Spacing="16">
          <Border Classes="card">
            <StackPanel Spacing="8">
              <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch" Spacing="8">
                <TextBlock Text="Outputs" Classes="card-title" />
                <TextBlock Text="{Binding Brain.LastOutputTickLabel, StringFormat='Last tick: {0}'}" Classes="muted" VerticalAlignment="Center" />
                <Button Content="Clear" Command="{Binding Brain.ClearOutputsCommand}" HorizontalAlignment="Right" />
              </StackPanel>
              <CheckBox Content="Hide zero outputs" IsChecked="{Binding Brain.FilterZeroOutputs}" />
              <ScrollViewer MaxHeight="260" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <ItemsControl ItemsSource="{Binding Brain.OutputEvents}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <Grid ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="10" Margin="0,4">
                        <TextBlock Text="{Binding TimeLabel}" Classes="muted" />
                        <TextBlock Grid.Column="1" Text="{Binding BrainId}" Classes="row-title" />
                        <Border Grid.Column="2" Classes="pill">
                          <TextBlock Text="{Binding OutputIndex}" />
                        </Border>
                        <TextBlock Grid.Column="3" Text="{Binding Value}" Classes="muted" />
                      </Grid>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </ScrollViewer>
            </StackPanel>
          </Border>

          <Border Classes="card">
            <StackPanel Spacing="8">
              <TextBlock Text="Vector Outputs" Classes="card-title" />
              <CheckBox Content="Hide zero vectors" IsChecked="{Binding Brain.FilterZeroVectorOutputs}" />
              <ScrollViewer MaxHeight="220" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <ItemsControl ItemsSource="{Binding Brain.VectorEvents}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate>
                      <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10" Margin="0,4">
                        <TextBlock Text="{Binding TimeLabel}" Classes="muted" />
                        <TextBlock Grid.Column="1" Text="{Binding ValuesPreview}" Classes="row-title" />
                        <TextBlock Grid.Column="2" Text="{Binding TickId}" Classes="muted" />
                      </Grid>
                    </DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>
              </ScrollViewer>
            </StackPanel>
          </Border>
        </StackPanel>
      </Grid>

      <Border Classes="card">
        <StackPanel Spacing="8">
          <Grid ColumnDefinitions="Auto,Auto,Auto,*,Auto,Auto" ColumnSpacing="8" RowDefinitions="Auto,Auto" RowSpacing="6">
            <TextBlock Text="Visualization Stream" Classes="card-title" />
            <ComboBox Grid.Column="1" ItemsSource="{Binding VizTypeOptions}" SelectedItem="{Binding SelectedVizType}" Width="180">
              <ComboBox.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding Label}" />
                </DataTemplate>
              </ComboBox.ItemTemplate>
            </ComboBox>
            <TextBox Grid.Column="2" Width="80" Text="{Binding RegionFilterText}" Watermark="Region" />
            <TextBox Grid.Column="3" Text="{Binding SearchFilterText}" Watermark="Search type, addr, id" />
            <Button Grid.Column="4" Content="Export" Command="{Binding ExportCommand}" />
            <Button Grid.Column="5" Content="Clear" Command="{Binding ClearCommand}" />
            <TextBlock Grid.Row="1" Grid.ColumnSpan="6" Text="{Binding Status}" Classes="muted" />
          </Grid>

          <Grid ColumnDefinitions="1.3*,1*" ColumnSpacing="16">
            <StackPanel Spacing="8">
              <ListBox ItemsSource="{Binding VizEvents}" SelectedItem="{Binding SelectedEvent}" MaxHeight="320">
                <ListBox.ItemTemplate>
                  <DataTemplate>
                    <Border Classes="row">
                      <Grid ColumnDefinitions="Auto,Auto,*,Auto" ColumnSpacing="10">
                        <TextBlock Text="{Binding Time}" Classes="muted" />
                        <Border Grid.Column="1" Classes="pill">
                          <TextBlock Text="{Binding Type}" />
                        </Border>
                        <TextBlock Grid.Column="2" Text="{Binding BrainId}" Classes="row-title" />
                        <TextBlock Grid.Column="3" Text="{Binding Value}" Classes="muted" />
                      </Grid>
                    </Border>
                  </DataTemplate>
                </ListBox.ItemTemplate>
              </ListBox>
            </StackPanel>
            <StackPanel Grid.Column="1" Spacing="8">
              <TextBlock Text="Event Details" Classes="card-title" />
              <TextBlock Text="{Binding SelectedEvent.Type}" Classes="row-title" />
              <TextBlock Text="{Binding SelectedEvent.BrainId}" Classes="muted" />
              <TextBlock Text="{Binding SelectedEvent.Region, StringFormat='Region {0}'}" Classes="muted" />
              <TextBox Text="{Binding SelectedPayload}" IsReadOnly="True" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="160" />
            </StackPanel>
          </Grid>
        </StackPanel>
      </Border>
    </StackPanel>
  </ScrollViewer>
</UserControl>
