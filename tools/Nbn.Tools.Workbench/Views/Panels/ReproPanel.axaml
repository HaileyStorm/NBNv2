<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:Nbn.Tools.Workbench.ViewModels"
             x:Class="Nbn.Tools.Workbench.Views.Panels.ReproPanel"
             x:DataType="vm:ReproPanelViewModel">
  <ScrollViewer HorizontalScrollBarVisibility="Disabled">
    <StackPanel Spacing="16">
      <Border Classes="card">
        <StackPanel Spacing="8">
          <TextBlock Text="Reproduction" Classes="card-title" />
          <TextBlock Text="Choose active brains or upload parent artifacts (.nbn + optional .nbs)." Classes="card-subtitle" />
        </StackPanel>
      </Border>

      <Border Classes="card">
        <StackPanel Spacing="10">
          <TextBlock Text="Parents" Classes="card-title" />

          <TextBlock Text="Active brain selection" Classes="muted row-title" />
          <Grid ColumnDefinitions="Auto,*,Auto,*" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="10" RowSpacing="6">
            <TextBlock Text="Parent A" Classes="muted" />
            <ComboBox Grid.Column="1" ItemsSource="{Binding ActiveBrains}" SelectedItem="{Binding SelectedParentABrain}" Width="300">
              <ComboBox.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding Label}" />
                </DataTemplate>
              </ComboBox.ItemTemplate>
            </ComboBox>
            <TextBlock Grid.Column="2" Text="Parent B" Classes="muted" />
            <ComboBox Grid.Column="3" ItemsSource="{Binding ActiveBrains}" SelectedItem="{Binding SelectedParentBBrain}" Width="300">
              <ComboBox.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding Label}" />
                </DataTemplate>
              </ComboBox.ItemTemplate>
            </ComboBox>

            <TextBlock Grid.Row="1" Text="Parent A GUID" Classes="muted" />
            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding ParentAGuidText}" Watermark="Fallback GUID" />
            <TextBlock Grid.Row="1" Grid.Column="2" Text="Parent B GUID" Classes="muted" />
            <TextBox Grid.Row="1" Grid.Column="3" Text="{Binding ParentBGuidText}" Watermark="Fallback GUID" />

            <TextBlock Grid.Row="2" Text="Seed" Classes="muted" />
            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding SeedText}" Watermark="auto" Width="180" />
          </Grid>

          <TextBlock Text="Artifact upload mode (used when both parent .nbn paths are set)" Classes="muted row-title" />
          <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto,Auto,Auto,Auto" ColumnSpacing="10" RowSpacing="6">
            <TextBlock Text="A .nbn" Classes="muted" />
            <TextBox Grid.Column="1" Text="{Binding ParentADefPath}" Watermark="Path to parent A definition" />
            <Button Grid.Column="2" Content="Browse" Command="{Binding BrowseParentADefCommand}" />

            <TextBlock Grid.Row="1" Text="A .nbs" Classes="muted" />
            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding ParentAStatePath}" Watermark="Optional parent A state" />
            <Button Grid.Row="1" Grid.Column="2" Content="Browse" Command="{Binding BrowseParentAStateCommand}" />

            <TextBlock Grid.Row="2" Text="B .nbn" Classes="muted" />
            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding ParentBDefPath}" Watermark="Path to parent B definition" />
            <Button Grid.Row="2" Grid.Column="2" Content="Browse" Command="{Binding BrowseParentBDefCommand}" />

            <TextBlock Grid.Row="3" Text="B .nbs" Classes="muted" />
            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding ParentBStatePath}" Watermark="Optional parent B state" />
            <Button Grid.Row="3" Grid.Column="2" Content="Browse" Command="{Binding BrowseParentBStateCommand}" />

            <TextBlock Grid.Row="4" Text="Artifact root" Classes="muted" />
            <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding ArtifactStoreRoot}" />
            <Button Grid.Row="4" Grid.Column="2" Content="Clear Files" Command="{Binding ClearParentFilesCommand}" />
          </Grid>

          <StackPanel Orientation="Horizontal" Spacing="8">
            <TextBlock Text="Strength" Classes="muted" VerticalAlignment="Center" />
            <ComboBox ItemsSource="{Binding StrengthSources}" SelectedItem="{Binding SelectedStrengthSource}" Width="160">
              <ComboBox.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding Label}" />
                </DataTemplate>
              </ComboBox.ItemTemplate>
            </ComboBox>
            <TextBlock Text="Spawn child" Classes="muted" VerticalAlignment="Center" />
            <ComboBox ItemsSource="{Binding SpawnPolicies}" SelectedItem="{Binding SelectedSpawnPolicy}" Width="140">
              <ComboBox.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding Label}" />
                </DataTemplate>
              </ComboBox.ItemTemplate>
            </ComboBox>
            <TextBlock Text="Prune" Classes="muted" VerticalAlignment="Center" />
            <ComboBox ItemsSource="{Binding PrunePolicies}" SelectedItem="{Binding SelectedPrunePolicy}" Width="210">
              <ComboBox.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding Label}" />
                </DataTemplate>
              </ComboBox.ItemTemplate>
            </ComboBox>
          </StackPanel>
        </StackPanel>
      </Border>

      <Border Classes="card">
        <StackPanel Spacing="8" Grid.IsSharedSizeScope="True">
          <TextBlock Text="Similarity" Classes="card-title" />
          <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="6">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto" SharedSizeGroup="reproLabel" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <TextBlock Text="Max span diff" Classes="muted" />
            <TextBox Grid.Column="1" Text="{Binding MaxRegionSpanDiffRatio}" Width="120" />
            <TextBlock Grid.Row="1" Text="Max func dist" Classes="muted" />
            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding MaxFunctionHistDistance}" Width="120" />
            <TextBlock Grid.Row="2" Text="Max conn dist" Classes="muted" />
            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding MaxConnectivityHistDistance}" Width="120" />
            <TextBlock Grid.Row="3" Text="Max avg out" Classes="muted" />
            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding MaxAvgOutDegree}" Width="120" />
            <TextBlock Grid.Row="4" Text="Per-region avg caps" Classes="muted" />
            <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding PerRegionOutDegreeCaps}" Width="320" Watermark="region:cap, region:cap" />
          </Grid>
        </StackPanel>
      </Border>

      <Border Classes="card">
        <StackPanel Spacing="10" Grid.IsSharedSizeScope="True">
          <TextBlock Text="Mutation" Classes="card-title" />

          <TextBlock Text="Structure + connectivity" Classes="muted row-title" />
          <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="6">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto" SharedSizeGroup="reproLabel2" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <TextBlock Text="Prob add first neuron" Classes="muted" />
            <TextBox Grid.Column="1" Text="{Binding ProbAddNeuronToEmptyRegion}" Width="120" />
            <TextBlock Grid.Row="1" Text="Prob remove last neuron" Classes="muted" />
            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding ProbRemoveLastNeuronFromRegion}" Width="120" />
            <TextBlock Grid.Row="2" Text="Prob disable neuron" Classes="muted" />
            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding ProbDisableNeuron}" Width="120" />
            <TextBlock Grid.Row="3" Text="Prob reactivate neuron" Classes="muted" />
            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding ProbReactivateNeuron}" Width="120" />
            <TextBlock Grid.Row="4" Text="Prob add axon" Classes="muted" />
            <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding ProbAddAxon}" Width="120" />
            <TextBlock Grid.Row="5" Text="Prob remove axon" Classes="muted" />
            <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding ProbRemoveAxon}" Width="120" />
            <TextBlock Grid.Row="6" Text="Prob reroute axon" Classes="muted" />
            <TextBox Grid.Row="6" Grid.Column="1" Text="{Binding ProbRerouteAxon}" Width="120" />
            <TextBlock Grid.Row="7" Text="Prob reroute inbound on delete" Classes="muted" />
            <TextBox Grid.Row="7" Grid.Column="1" Text="{Binding ProbRerouteInboundAxonOnDelete}" Width="120" />
            <TextBlock Grid.Row="8" Text="Inbound reroute max distance" Classes="muted" />
            <TextBox Grid.Row="8" Grid.Column="1" Text="{Binding InboundRerouteMaxRingDistance}" Width="120" />
          </Grid>

          <TextBlock Text="Value + function selection" Classes="muted row-title" />
          <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="6">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto" SharedSizeGroup="reproLabel2" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <TextBlock Text="Prob choose parent A" Classes="muted" />
            <TextBox Grid.Column="1" Text="{Binding ProbChooseParentA}" Width="120" />
            <TextBlock Grid.Row="1" Text="Prob choose parent B" Classes="muted" />
            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding ProbChooseParentB}" Width="120" />
            <TextBlock Grid.Row="2" Text="Prob average" Classes="muted" />
            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding ProbAverage}" Width="120" />
            <TextBlock Grid.Row="3" Text="Prob mutate values" Classes="muted" />
            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding ProbMutate}" Width="120" />
            <TextBlock Grid.Row="4" Text="Prob choose func A" Classes="muted" />
            <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding ProbChooseFuncA}" Width="120" />
            <TextBlock Grid.Row="5" Text="Prob mutate funcs" Classes="muted" />
            <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding ProbMutateFunc}" Width="120" />
          </Grid>

          <TextBlock Text="Strength mutations" Classes="muted row-title" />
          <StackPanel Orientation="Horizontal" Spacing="12">
            <CheckBox Content="Enable strength transform" IsChecked="{Binding StrengthTransformEnabled}" />
          </StackPanel>
          <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="6">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto" SharedSizeGroup="reproLabel2" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <TextBlock Text="Prob choose A" Classes="muted" />
            <TextBox Grid.Column="1" Text="{Binding ProbStrengthChooseA}" Width="120" />
            <TextBlock Grid.Row="1" Text="Prob choose B" Classes="muted" />
            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding ProbStrengthChooseB}" Width="120" />
            <TextBlock Grid.Row="2" Text="Prob average" Classes="muted" />
            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding ProbStrengthAverage}" Width="120" />
            <TextBlock Grid.Row="3" Text="Prob weighted avg" Classes="muted" />
            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding ProbStrengthWeightedAverage}" Width="120" />
            <TextBlock Grid.Row="4" Text="Weight A" Classes="muted" />
            <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding StrengthWeightA}" Width="120" />
            <TextBlock Grid.Row="5" Text="Weight B" Classes="muted" />
            <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding StrengthWeightB}" Width="120" />
            <TextBlock Grid.Row="6" Text="Prob mutate" Classes="muted" />
            <TextBox Grid.Row="6" Grid.Column="1" Text="{Binding ProbStrengthMutate}" Width="120" />
          </Grid>

          <TextBlock Text="Limits (0 means unlimited)" Classes="muted row-title" />
          <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="6">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto" SharedSizeGroup="reproLabel2" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <TextBlock Text="Max neurons added abs" Classes="muted" />
            <TextBox Grid.Column="1" Text="{Binding MaxNeuronsAddedAbs}" Width="120" />
            <TextBlock Grid.Row="1" Text="Max neurons added pct" Classes="muted" />
            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding MaxNeuronsAddedPct}" Width="120" />
            <TextBlock Grid.Row="2" Text="Max neurons removed abs" Classes="muted" />
            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding MaxNeuronsRemovedAbs}" Width="120" />
            <TextBlock Grid.Row="3" Text="Max neurons removed pct" Classes="muted" />
            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding MaxNeuronsRemovedPct}" Width="120" />
            <TextBlock Grid.Row="4" Text="Max axons added abs" Classes="muted" />
            <TextBox Grid.Row="4" Grid.Column="1" Text="{Binding MaxAxonsAddedAbs}" Width="120" />
            <TextBlock Grid.Row="5" Text="Max axons added pct" Classes="muted" />
            <TextBox Grid.Row="5" Grid.Column="1" Text="{Binding MaxAxonsAddedPct}" Width="120" />
            <TextBlock Grid.Row="6" Text="Max axons removed abs" Classes="muted" />
            <TextBox Grid.Row="6" Grid.Column="1" Text="{Binding MaxAxonsRemovedAbs}" Width="120" />
            <TextBlock Grid.Row="7" Text="Max axons removed pct" Classes="muted" />
            <TextBox Grid.Row="7" Grid.Column="1" Text="{Binding MaxAxonsRemovedPct}" Width="120" />
            <TextBlock Grid.Row="8" Text="Max regions added abs" Classes="muted" />
            <TextBox Grid.Row="8" Grid.Column="1" Text="{Binding MaxRegionsAddedAbs}" Width="120" />
            <TextBlock Grid.Row="9" Text="Max regions removed abs" Classes="muted" />
            <TextBox Grid.Row="9" Grid.Column="1" Text="{Binding MaxRegionsRemovedAbs}" Width="120" />
          </Grid>
        </StackPanel>
      </Border>

      <Border Classes="card">
        <StackPanel Spacing="8">
          <StackPanel Orientation="Horizontal" Spacing="8">
            <Button Content="Run Reproduction" Command="{Binding RunCommand}" Classes="accent" />
            <TextBlock Text="{Binding Status}" Classes="muted" />
          </StackPanel>
        </StackPanel>
      </Border>

      <Grid ColumnDefinitions="*,*" ColumnSpacing="16">
        <Border Classes="card" Grid.Column="0">
          <StackPanel Spacing="6">
            <TextBlock Text="Similarity Result" Classes="card-title" />
            <TextBlock Text="{Binding SimilaritySummary}" TextWrapping="Wrap" />
          </StackPanel>
        </Border>
        <Border Classes="card" Grid.Column="1">
          <StackPanel Spacing="6">
            <TextBlock Text="Mutation Result" Classes="card-title" />
            <TextBlock Text="{Binding MutationSummary}" TextWrapping="Wrap" />
          </StackPanel>
        </Border>
      </Grid>
    </StackPanel>
  </ScrollViewer>
</UserControl>
