<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:Nbn.Tools.Workbench.ViewModels"
             x:Class="Nbn.Tools.Workbench.Views.Panels.DebugPanel"
             x:DataType="vm:DebugPanelViewModel">
  <ScrollViewer HorizontalScrollBarVisibility="Disabled">
    <StackPanel Spacing="16">
      <Border Classes="card">
        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="16">
          <StackPanel Spacing="8">
            <TextBlock Text="Filters" Classes="card-title" />
            <StackPanel Orientation="Horizontal" Spacing="8">
              <CheckBox IsChecked="{Binding StreamEnabled}" Content="Enable stream" VerticalAlignment="Center" />
              <TextBlock Text="Min severity" Classes="muted" VerticalAlignment="Center" />
              <ComboBox ItemsSource="{Binding SeverityOptions}" SelectedItem="{Binding SelectedSeverity}" Width="160">
                <ComboBox.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding Label}" />
                  </DataTemplate>
                </ComboBox.ItemTemplate>
              </ComboBox>
              <TextBlock Text="Context regex" Classes="muted" VerticalAlignment="Center" />
              <TextBox Width="220" Text="{Binding ContextRegex}" Watermark="tick|io|brain" />
              <TextBlock Text="Search" Classes="muted" VerticalAlignment="Center" />
              <TextBox Width="220" Text="{Binding TextFilter}" Watermark="message or context" />
            </StackPanel>
            <StackPanel Orientation="Horizontal" Spacing="8">
              <TextBlock Text="Include locations" Classes="muted" VerticalAlignment="Center" />
              <TextBox Width="220" Text="{Binding IncludeContextPrefixes}" Watermark="hivemind., region." />
              <TextBlock Text="Exclude locations" Classes="muted" VerticalAlignment="Center" />
              <TextBox Width="220" Text="{Binding ExcludeContextPrefixes}" Watermark="hivemind.tick" />
              <TextBlock Text="Include types" Classes="muted" VerticalAlignment="Center" />
              <TextBox Width="180" Text="{Binding IncludeSummaryPrefixes}" Watermark="brain., placement." />
              <TextBlock Text="Exclude types" Classes="muted" VerticalAlignment="Center" />
              <TextBox Width="180" Text="{Binding ExcludeSummaryPrefixes}" Watermark="tick.duplicate" />
            </StackPanel>
          </StackPanel>
          <StackPanel Spacing="8" HorizontalAlignment="Right">
            <Button Content="Apply" Command="{Binding ApplyFilterCommand}" Classes="accent" />
            <Button Content="Export" Command="{Binding ExportCommand}" />
            <Button Content="Clear" Command="{Binding ClearCommand}" />
            <TextBlock Text="{Binding Status}" Classes="muted" />
          </StackPanel>
        </Grid>
      </Border>

      <Border Classes="card">
        <Grid ColumnDefinitions="1.4*,1*" ColumnSpacing="16">
          <StackPanel Spacing="8">
            <TextBlock Text="Debug Stream" Classes="card-title" />
            <ListBox ItemsSource="{Binding DebugEvents}" SelectedItem="{Binding SelectedEvent}" MaxHeight="360">
              <ListBox.ItemTemplate>
                <DataTemplate>
                  <Border Classes="row">
                    <Grid ColumnDefinitions="Auto,Auto,*,*" ColumnSpacing="10">
                      <TextBlock Text="{Binding Time}" Classes="muted" />
                      <Border Grid.Column="1" Classes="pill">
                        <TextBlock Text="{Binding Severity}" />
                      </Border>
                      <TextBlock Grid.Column="2" Text="{Binding Context}" Classes="row-title" />
                      <TextBlock Grid.Column="3" Text="{Binding Summary}" Classes="muted" />
                    </Grid>
                  </Border>
                </DataTemplate>
              </ListBox.ItemTemplate>
            </ListBox>
          </StackPanel>
          <StackPanel Grid.Column="1" Spacing="8">
            <TextBlock Text="Event Details" Classes="card-title" />
            <TextBlock Text="{Binding SelectedEvent.Context}" Classes="row-title" TextWrapping="Wrap" />
            <TextBlock Text="{Binding SelectedEvent.Summary}" Classes="muted" TextWrapping="Wrap" />
            <TextBox Text="{Binding SelectedPayload}" IsReadOnly="True" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="160" />
          </StackPanel>
        </Grid>
      </Border>

      <Border Classes="card">
        <StackPanel Spacing="8">
          <Grid ColumnDefinitions="Auto,Auto,Auto,*,Auto,Auto" ColumnSpacing="8" RowDefinitions="Auto,Auto" RowSpacing="6">
            <TextBlock Text="Visualization Stream" Classes="card-title" />
            <ComboBox Grid.Column="1" ItemsSource="{Binding VizTypeOptions}" SelectedItem="{Binding SelectedVizType}" Width="180">
              <ComboBox.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding Label}" />
                </DataTemplate>
              </ComboBox.ItemTemplate>
            </ComboBox>
            <TextBox Grid.Column="2" Width="80" Text="{Binding VizRegionFilterText}" Watermark="Region" />
            <TextBox Grid.Column="3" Text="{Binding VizSearchFilterText}" Watermark="Search type, addr, id" />
            <Button Grid.Column="4" Content="Export" Command="{Binding ExportVizCommand}" />
            <Button Grid.Column="5" Content="Clear" Command="{Binding ClearVizCommand}" />
            <TextBlock Grid.Row="1" Grid.ColumnSpan="6" Text="{Binding VizStatus}" Classes="muted" />
          </Grid>

          <Grid ColumnDefinitions="1.3*,1*" ColumnSpacing="16">
            <StackPanel Spacing="8">
              <ListBox ItemsSource="{Binding VizEvents}" SelectedItem="{Binding SelectedVizEvent}" MaxHeight="320">
                <ListBox.ItemTemplate>
                  <DataTemplate>
                    <Border Classes="row">
                      <Grid ColumnDefinitions="Auto,Auto,*,Auto" ColumnSpacing="10">
                        <TextBlock Text="{Binding Time}" Classes="muted" />
                        <Border Grid.Column="1" Classes="pill">
                          <TextBlock Text="{Binding Type}" />
                        </Border>
                        <TextBlock Grid.Column="2" Text="{Binding BrainId}" Classes="row-title" />
                        <TextBlock Grid.Column="3" Text="{Binding Value}" Classes="muted" />
                      </Grid>
                    </Border>
                  </DataTemplate>
                </ListBox.ItemTemplate>
              </ListBox>
            </StackPanel>
            <StackPanel Grid.Column="1" Spacing="8">
              <TextBlock Text="Event Details" Classes="card-title" />
              <TextBlock Text="{Binding SelectedVizEvent.Type}" Classes="row-title" />
              <TextBlock Text="{Binding SelectedVizEvent.BrainId}" Classes="muted" />
              <TextBlock Text="{Binding SelectedVizEvent.Region, StringFormat='Region {0}'}" Classes="muted" />
              <TextBox Text="{Binding SelectedVizPayload}" IsReadOnly="True" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="160" />
            </StackPanel>
          </Grid>
        </StackPanel>
      </Border>
    </StackPanel>
  </ScrollViewer>
</UserControl>
