syntax = "proto3";
package nbn.settings;

option csharp_namespace = "Nbn.Proto.Settings";

import "nbn_common.proto";

message NodeOnline {
  nbn.Uuid node_id = 1;
  string logical_name = 2;
  string address = 3;          // host:port
  string root_actor_name = 4;  // stable
}

message NodeOffline {
  nbn.Uuid node_id = 1;
  string logical_name = 2;
}

message NodeHeartbeat {
  nbn.Uuid node_id = 1;
  fixed64 time_ms = 2;
  NodeCapabilities caps = 3;
}

message NodeCapabilities {
  uint32 cpu_cores = 1;
  fixed64 ram_free_bytes = 2;

  bool has_gpu = 3;
  string gpu_name = 4;
  fixed64 vram_free_bytes = 5;

  float cpu_score = 6;
  float gpu_score = 7;

  bool ilgpu_cuda_available = 8;
  bool ilgpu_opencl_available = 9;
}

message NodeStatus {
  nbn.Uuid node_id = 1;
  string logical_name = 2;
  string address = 3;
  string root_actor_name = 4;
  fixed64 last_seen_ms = 5;
  bool is_alive = 6;
}

message BrainStatus {
  nbn.Uuid brain_id = 1;
  fixed64 spawned_ms = 2;
  fixed64 last_tick_id = 3;
  string state = 4;
}

message BrainControllerStatus {
  nbn.Uuid brain_id = 1;
  nbn.Uuid node_id = 2;
  string actor_name = 3;
  fixed64 last_seen_ms = 4;
  bool is_alive = 5;
}

message NodeListRequest { }

message NodeListResponse {
  repeated NodeStatus nodes = 1;
}

message BrainListRequest { }

message BrainListResponse {
  repeated BrainStatus brains = 1;
  repeated BrainControllerStatus controllers = 2;
}

message SettingListRequest { }

message SettingListResponse {
  repeated SettingValue settings = 1;
}

message SettingGet {
  string key = 1;
}

message SettingValue {
  string key = 1;
  string value = 2;
  fixed64 updated_ms = 3;
}

message SettingSet {
  string key = 1;
  string value = 2;
}

message SettingChanged {
  string key = 1;
  string value = 2;
  fixed64 updated_ms = 3;
}

message SettingSubscribe {
  string subscriber_actor = 1; // actor name/path
}

message SettingUnsubscribe {
  string subscriber_actor = 1;
}

message BrainRegistered {
  nbn.Uuid brain_id = 1;
  fixed64 spawned_ms = 2;
  fixed64 last_tick_id = 3;
  string state = 4;

  nbn.Uuid controller_node_id = 5;
  string controller_node_address = 6;
  string controller_node_logical_name = 7;
  string controller_root_actor_name = 8;
  string controller_actor_name = 9;
}

message BrainStateChanged {
  nbn.Uuid brain_id = 1;
  string state = 2;
  string notes = 3;
}

message BrainTick {
  nbn.Uuid brain_id = 1;
  fixed64 last_tick_id = 2;
}

message BrainControllerHeartbeat {
  nbn.Uuid brain_id = 1;
  fixed64 time_ms = 2;
}

message BrainUnregistered {
  nbn.Uuid brain_id = 1;
  fixed64 time_ms = 2;
}
